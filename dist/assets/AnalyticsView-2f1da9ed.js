import{u as Y}from"./useAnalytics-fd02d146.js";import{u as G,_ as U}from"./index-1a4d3832.js";import{a2 as q,D as g,d as Q,r as Z,f as x,q as J,c as O,a as t,b as l,u as a,t as d,k as p,o as P,O as K,a3 as W,G as A,V as R,a4 as N,L as X,I as L,a5 as ee,J as H,K as I,H as te,n as ae,F as se,l as oe,a6 as ne}from"./vendor-4ce8851e.js";function ie(){const h=Y(),m=G(),C=e=>new Intl.NumberFormat("nl-NL",{style:"currency",currency:"EUR"}).format(e),v=e=>g.fromISO(e).toFormat("dd MMM yyyy"),y=e=>g.fromISO(e).toFormat("dd MMM yyyy HH:mm"),k=()=>{const e=m.leads.map(o=>({Name:o.name,Email:o.email,Phone:o.phone,Status:o.status,"Decision Date":v(o.decisionDate),"Quotation Value":C(o.quotationValue||0),Priority:o.priority,"Success Rate":`${o.successRate}%`,"Lead Score":o.leadscore,"Created At":y(o.createdAt)})),r=Papa.unparse(e);T(r,"leads_export.csv")},V=()=>{const e=m.tasks.map(o=>{var c;return{"Lead Name":((c=m.getLeadById.value(o.leadId))==null?void 0:c.name)||"",Type:o.type,Title:o.title,Description:o.description,"Scheduled Date":y(o.scheduledDate),Status:o.completed?"Completed":"Pending"}}),r=Papa.unparse(e);T(r,"tasks_export.csv")},F=()=>{const e=m.communications.map(o=>{var c;return{"Lead Name":((c=m.getLeadById.value(o.leadId))==null?void 0:c.name)||"",Type:o.type,Method:o.method,Content:o.content,Timestamp:y(o.timestamp)}}),r=Papa.unparse(e);T(r,"communications_export.csv")},_=()=>{const e=new q,r=g.now().toFormat("dd MMM yyyy");e.setFontSize(20),e.text("OptiCRM Analytics Report",20,20),e.setFontSize(12),e.text(`Generated on ${r}`,20,30),e.setFontSize(16),e.text("Lead Funnel",20,45);const o=Object.entries(h.leadFunnel.value).map(([D,b])=>[D,b.count.toString(),`${b.percentage.toFixed(1)}%`]);e.autoTable({startY:50,head:[["Stage","Count","Percentage"]],body:o});const c=e.lastAutoTable.finalY+15;e.setFontSize(16),e.text("Task Statistics",20,c);const f=[["Completed Tasks",h.taskStats.value.completed.toString()],["In Progress Tasks",h.taskStats.value.inProgress.toString()]];e.autoTable({startY:c+5,head:[["Metric","Value"]],body:f});const S=e.lastAutoTable.finalY+15;e.setFontSize(16),e.text("Communication Statistics",20,S);const u=[["Outbound Communications",h.communicationStats.value.byType.outbound.toString()],["Inbound Communications",h.communicationStats.value.byType.inbound.toString()]];e.autoTable({startY:S+5,head:[["Type","Count"]],body:u});const M=e.lastAutoTable.finalY+15;e.setFontSize(16),e.text("Revenue Statistics",20,M);const $=h.revenueStats.value.months.map((D,b)=>[D,`$${h.revenueStats.value.values[b].toLocaleString()}`]);e.autoTable({startY:M+5,head:[["Month","Revenue"]],body:$}),e.save("opticrm-analytics-report.pdf")},w=async e=>{const r=m.getLeadById.value(e);if(!r)return;const o=m.getLeadTasks.value(e),c=m.getLeadCommunications.value(e),f=m.getLeadNotes.value(e),S={content:[{text:r.name,style:"header",margin:[0,0,0,20]},{columns:[{width:"auto",text:[{text:"Status: ",bold:!0},r.status]},{width:"auto",text:[{text:"Lead Score: ",bold:!0},r.leadscore.toString()]}],columnGap:20,margin:[0,0,0,20]},{text:"Lead Details",style:"sectionHeader",margin:[0,0,0,10]},{table:{headerRows:1,widths:["*","*"],body:[["Field","Value"],["Email",r.email||"Not specified"],["Phone",r.phone||"Not specified"],["Decision Date",v(r.decisionDate)],["Quotation Value",C(r.quotationValue||0)],["Priority",`${r.priority}/10`],["Success Rate",`${r.successRate}%`]]},margin:[0,0,0,20]},{text:"Tasks",style:"sectionHeader",margin:[0,0,0,10]},{table:{headerRows:1,widths:["auto","*","auto","auto"],body:[["Type","Title","Date","Status"],...o.map(u=>[u.type,u.title,y(u.scheduledDate),u.completed?"Completed":"Pending"])]},margin:[0,0,0,20]},{text:"Communications",style:"sectionHeader",margin:[0,0,0,10]},{table:{headerRows:1,widths:["auto","auto","*","auto"],body:[["Type","Method","Content","Date"],...c.map(u=>[u.type,u.method,u.content,y(u.timestamp)])]},margin:[0,0,0,20]},{text:"Notes",style:"sectionHeader",margin:[0,0,0,10]},{table:{headerRows:1,widths:["*","auto"],body:[["Content","Date"],...f.map(u=>[u.content,y(u.createdAt)])]}}],styles:{header:{fontSize:24,bold:!0,color:"#3e5b82"},sectionHeader:{fontSize:18,bold:!0,color:"#3e5b82"}},defaultStyle:{font:"Helvetica"}};pdfMake.createPdf(S).download(`lead_report_${r.name}.pdf`)},T=(e,r)=>{const o=new Blob([e],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");if(c.download!==void 0){const f=URL.createObjectURL(o);c.setAttribute("href",f),c.setAttribute("download",r),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}};return{exportLeadsToCSV:k,exportTasksToCSV:V,exportCommunicationsToCSV:F,generateAnalyticsReport:_,exportLeadDetailToPDF:w}}const le={class:"analytics-view"},re={class:"analytics-header"},ce={class:"header-actions"},de={class:"period-selector"},ue={class:"metrics-grid"},me={class:"metric-card"},pe={class:"metric-value"},ye={class:"metric-subtitle"},ve={class:"metric-card"},be={class:"metric-value"},he={class:"metric-subtitle"},fe={class:"metric-card"},_e={class:"metric-value"},Se={class:"metric-subtitle"},ge={class:"metric-card"},Ce={class:"metric-value"},Te={class:"metric-subtitle"},De={class:"charts-grid"},xe={class:"activity-item"},Le={class:"activity-date"},ke={class:"activity-content"},Ve={class:"performance-grid"},we={class:"performance-stats"},Me={class:"stat-item"},Ae={class:"stat-item"},Re={class:"stat-item"},Fe={class:"stat-item"},$e=Q({__name:"AnalyticsView",setup(h){const{leadMetrics:m,leadFunnel:C,activityMetrics:v,performanceMetrics:y,conversionMetrics:k,taskDistribution:V,qualityScoreTrends:F}=Y(),_=ie(),w=Z({label:"Last 30 Days",value:30}),T=[{label:"Last 7 Days",value:7},{label:"Last 30 Days",value:30},{label:"Last 90 Days",value:90},{label:"This Year",value:365}],e=[{label:"Export Analytics Report (PDF)",icon:"pi pi-file-pdf",command:()=>_.exportAnalyticsToPDF()},{label:"Export Leads (CSV)",icon:"pi pi-file-excel",command:()=>_.exportLeadsToCSV()},{label:"Export Tasks (CSV)",icon:"pi pi-file-excel",command:()=>_.exportTasksToCSV()},{label:"Export Communications (CSV)",icon:"pi pi-file-excel",command:()=>_.exportCommunicationsToCSV()}],r=x(()=>({labels:C.value.map(n=>n.stage),datasets:[{data:C.value.map(n=>n.count),backgroundColor:["#3e5b82","#4a6b92","#567ba2","#628bb2","#6e9bc2","#7aabd2","#86bbe2"]}]})),o=x(()=>({labels:y.value.monthly.map(n=>n.month),datasets:[{label:"Leads",data:y.value.monthly.map(n=>n.leads),borderColor:"#3e5b82",tension:.4},{label:"Tasks Completed",data:y.value.monthly.map(n=>n.completedTasks),borderColor:"#ee9b4c",tension:.4}]})),c=x(()=>({labels:Object.keys(V.value.byType),datasets:[{data:Object.values(V.value.byType),backgroundColor:["#3e5b82","#ee9b4c","#f9cca1","#90c2dd"]}]})),f=x(()=>{const n=v.value.communicationStats.byTypeLast30Days;return{labels:Object.keys(n),datasets:[{label:"Communications",data:Object.values(n),backgroundColor:"#3e5b82"}]}}),S={maintainAspectRatio:!1,plugins:{legend:{display:!1}}},u={maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},scales:{y:{beginAtZero:!0}}},M={maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}},$={maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}},D=x(()=>{const n=[];return v.value.taskCompletion.last30Days.completed.forEach(s=>{n.push({date:s.scheduledDate,type:"Task",description:`Completed: ${s.title}`,icon:"pi pi-check-circle",severity:"success"})}),v.value.communicationStats.last30Days.forEach(s=>{n.push({date:s.timestamp,type:s.type,description:`${s.method}: ${s.content.substring(0,50)}...`,icon:"pi pi-comments",severity:s.type==="inbound"?"info":"warning"})}),n.sort((s,i)=>g.fromISO(i.date).toMillis()-g.fromISO(s.date).toMillis())});function b(n){return new Intl.NumberFormat("nl-NL",{style:"currency",currency:"EUR"}).format(n)}function E(n){return`${Math.round(n)}%`}function z(n){return Math.round(n*10)/10}function B(n){return g.fromISO(n).toFormat("dd MMM yyyy HH:mm")}function j(n){return{"Hot en snel beslissen":"danger",Hot:"danger","Snel beslissen":"warning","Goede kans":"success","Goede kans, warm houden":"success",Standaard:"info","Niets mee doen":"secondary"}[n]||"info"}return J(()=>{}),(n,s)=>(P(),O("div",le,[t("div",re,[s[1]||(s[1]=t("h1",null,"Analytics Dashboard",-1)),t("div",ce,[t("div",de,[l(a(K),{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=i=>w.value=i),options:T,optionLabel:"label",placeholder:"Select Period"},null,8,["modelValue"])]),l(a(W),{label:"Export",icon:"pi pi-download",model:e,class:"p-button-outlined"})])]),t("div",ue,[t("div",me,[s[2]||(s[2]=t("div",{class:"metric-title"},"Total Leads",-1)),t("div",pe,d(a(m).total),1),t("div",ye," Value: "+d(b(a(m).totalValue)),1)]),t("div",ve,[s[3]||(s[3]=t("div",{class:"metric-title"},"Conversion Rate",-1)),t("div",be,d(E(a(k).conversionRate)),1),t("div",he,d(a(k).highPriorityLeads)+" High Priority Leads ",1)]),t("div",fe,[s[4]||(s[4]=t("div",{class:"metric-title"},"Task Completion",-1)),t("div",_e,d(E(a(v).taskCompletion.completed/a(v).taskCompletion.total*100)),1),t("div",Se,d(a(v).taskCompletion.completed)+"/"+d(a(v).taskCompletion.total)+" Tasks ",1)]),t("div",ge,[s[5]||(s[5]=t("div",{class:"metric-title"},"Avg Lead Score",-1)),t("div",Ce,d(z(a(m).avgScore)),1),t("div",Te," Avg Value: "+d(b(a(m).avgValue)),1)])]),t("div",De,[l(a(R),{header:"Lead Funnel",class:"chart-panel"},{default:p(()=>[l(a(A),{type:"funnel",data:r.value,options:S},null,8,["data"])]),_:1}),l(a(R),{header:"Monthly Performance",class:"chart-panel"},{default:p(()=>[l(a(A),{type:"line",data:o.value,options:u},null,8,["data"])]),_:1}),l(a(R),{header:"Task Distribution",class:"chart-panel"},{default:p(()=>[l(a(A),{type:"pie",data:c.value,options:M},null,8,["data"])]),_:1}),l(a(R),{header:"Communication Activity",class:"chart-panel"},{default:p(()=>[l(a(A),{type:"bar",data:f.value,options:$},null,8,["data"])]),_:1})]),l(a(ne),null,{default:p(()=>[l(a(N),{header:"Lead Quality Analysis"},{default:p(()=>[l(a(X),{value:a(F).all,paginator:!0,rows:10,sortField:"score",sortOrder:-1,class:"analytics-table"},{default:p(()=>[l(a(L),{field:"name",header:"Lead Name",sortable:""}),l(a(L),{field:"score",header:"Quality Score",sortable:""},{body:p(({data:i})=>[l(a(ee),{value:i.score,showValue:!0},null,8,["value"])]),_:1}),l(a(L),{field:"value",header:"Value",sortable:""},{body:p(({data:i})=>[H(d(b(i.value)),1)]),_:1}),l(a(L),{field:"priority",header:"Priority",sortable:""}),l(a(L),{field:"status",header:"Status",sortable:""},{body:p(({data:i})=>[l(a(I),{value:i.status,severity:j(i.status)},null,8,["value","severity"])]),_:1})]),_:1},8,["value"])]),_:1}),l(a(N),{header:"Activity Timeline"},{default:p(()=>[l(a(te),{value:D.value,class:"activity-timeline"},{content:p(i=>[t("div",xe,[t("small",Le,d(B(i.item.date)),1),t("div",ke,[t("i",{class:ae(i.item.icon)},null,2),H(" "+d(i.item.description),1)]),l(a(I),{value:i.item.type,severity:i.item.severity},null,8,["value","severity"])])]),_:1},8,["value"])]),_:1}),l(a(N),{header:"Performance Metrics"},{default:p(()=>[t("div",Ve,[(P(!0),O(se,null,oe(a(y).monthly,i=>(P(),O("div",{key:i.month,class:"performance-card"},[t("h3",null,d(i.month),1),t("div",we,[t("div",Me,[s[6]||(s[6]=t("label",null,"New Leads",-1)),t("span",null,d(i.leads),1)]),t("div",Ae,[s[7]||(s[7]=t("label",null,"Tasks Completed",-1)),t("span",null,d(i.completedTasks)+"/"+d(i.tasks),1)]),t("div",Re,[s[8]||(s[8]=t("label",null,"Communications",-1)),t("span",null,d(i.communications),1)]),t("div",Fe,[s[9]||(s[9]=t("label",null,"Value",-1)),t("span",null,d(b(i.value)),1)])])]))),128))])]),_:1})]),_:1})]))}});const Ee=U($e,[["__scopeId","data-v-bec5e214"]]);export{Ee as default};
//# sourceMappingURL=AnalyticsView-2f1da9ed.js.map
